apiVersion: "nais.io/v1alpha1"
kind: "Application"
metadata:
  name: modiapersonoversikt-api
  {{#if namespace}}
  namespace: {{namespace}}
  {{else}}
  namespace: default
  {{/if}}
  labels:
    team: personoversikt
spec:
  image: {{ image }}
  port: 8080
  team: personoversikt
  liveness:
    path: /modiapersonoversikt-api/internal/isAlive
    initialDelay: 50
    timeout: 1
    periodSeconds: 5
    failureThreshold: 10
  readiness:
    path: /modiapersonoversikt-api/internal/isReady
    initialDelay: 50
    timeout: 1
  prometheus:
    enabled: true
    path: /modiapersonoversikt-api/internal/metrics
  resources:
    requests:
      cpu: 1000m
      memory: 4096Mi
    limits:
      cpu: 2000m
      memory: 8192Mi
  ingresses:
  {{#each ingresses}}
    - {{this}}
  {{/each}}
  replicas:
    {{#if replicaMin}}
    min: {{replicaMin}}
    {{else}}
    min: 1
    {{/if}}
    {{#if replicaMax}}
    max: {{replicaMax}}
    {{else}}
    max: 2
    {{/if}}
    cpuThresholdPercentage: 60
  vault:
    enabled: true
    {{#if vaultPaths}}
    paths:
      {{#each vaultPaths}}
      - kvPath: {{@key}}
        mountPath: {{this}}
      {{/each}}
    {{/if}}
  {{#if env}}
  env:
    {{#each env}}
    - name: {{@key}}
      value: "{{this}}"
    {{/each}}
  {{/if}}}